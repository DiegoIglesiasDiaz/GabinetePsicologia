@page "/Psicologo/Trastornos"
@using GabinetePsicologia.Shared
@inject AuthenticationStateProvider AuthenticationStateProvider
<h3>Trastornos</h3>
<RadzenButton Text="Añadir Trastorno" ButtonStyle="ButtonStyle.Primary" Click=@(args => { trastornoForm = new Trastorno();ShowInlineDialog(); }) Style="margin-left:auto;margin-right:0" />
<RadzenButton Text="Borrar Trastorno" ButtonStyle="ButtonStyle.Primary" Click=@BorrarTrastorno Style="margin-left:auto;margin-right:0" />
<RadzenDataGrid @ref="grid" AllowFiltering="true" FilterPopupRenderMode="PopupRenderMode.OnDemand" FilterCaseSensitivity="FilterCaseSensitivity.CaseInsensitive" AllowPaging="true" PageSize="8"
                AllowSorting="true" Data="@LsTrastornos" TItem="Trastorno" ColumnWidth="200px"
                SelectionMode="DataGridSelectionMode.Multiple" @bind-Value=@selectedTrastornos class="m-4">
    <Columns>
        <RadzenDataGridColumn TItem="Trastorno" Width="60px" Sortable="false" Filterable="false">
            <HeaderTemplate>
                <RadzenCheckBox TriState="false" TValue="bool" Value="@( selectedTrastornos != null && LsTrastornos.Count().Equals(selectedTrastornos.Count()))"
                                Change="@(args => selectedTrastornos = args ? LsTrastornos.ToList() : null)" />
            </HeaderTemplate>
            <Template Context="data">
                <RadzenCheckBox TriState="false" Value="@(selectedTrastornos != null && selectedTrastornos.Contains(data))"
                                TValue="bool" Change=@(args => { if(!allowRowSelectOnRowClick) { grid.SelectRow(data); }}) />
            </Template>
        </RadzenDataGridColumn>

        <RadzenDataGridColumn TItem="Trastorno" Property="Nombre" Title="Nombre" />
        <RadzenDataGridColumn TItem="Trastorno" Property="Tipo" Title="Tipo" />
        <RadzenDataGridColumn TItem="Trastorno" Property="Sintomas" Title="Sintomas" />
        <RadzenDataGridColumn TItem="Trastorno" Width="60px" Sortable="false" Filterable="false">
            <Template Context="data">
                <RadzenButton Text="Editar" Click=@(args => { trastornoForm = data;ShowInlineDialog(); }) ButtonStyle="ButtonStyle.Secondary" />
            </Template>
        </RadzenDataGridColumn>


    </Columns>
</RadzenDataGrid>

@code {
    async Task ShowInlineDialog()
    {
        string titulo = "";
        if (trastornoForm.Id == Guid.Empty)
            titulo = "Añadir Trastorno";
        else
          titulo = "Editar Trastorno";
          

        var result = await DialogService.OpenAsync(titulo, ds =>
    @<div>
        <div class="row">
            <div class="col">
                <RadzenCard>
                    <RadzenText TextStyle="TextStyle.Subtitle2" TagName="TagName.H3">Nombre</RadzenText>
                    <RadzenTextBox @bind-Value=trastornoForm.Nombre Name="name" class="w-100" />
                    <RadzenRequiredValidator Component="name" Text="*Nombre requerido"></RadzenRequiredValidator>
                </RadzenCard>
                <RadzenCard>
                    <RadzenText TextStyle="TextStyle.Subtitle2" TagName="TagName.H3">Tipo</RadzenText>
                    <RadzenTextBox @bind-Value=trastornoForm.Tipo Name="Tipo" class="w-100" />
                    <RadzenRequiredValidator Component="Tipo" Text="*Nombre requerido"></RadzenRequiredValidator>
                </RadzenCard>
                <RadzenCard>
                    <RadzenText TextStyle="TextStyle.Subtitle2" TagName="TagName.H3">Síntomas</RadzenText>
                    <RadzenTextArea @bind-Value=trastornoForm.Sintomas Name="Sintomas" class="w-100" />
                    <RadzenRequiredValidator Component="Sintomas" Text="*Nombre requerido"></RadzenRequiredValidator>
                </RadzenCard>

                <br><br>
                <div style="display:flex;align-items:center;justify-content:center">
                    <RadzenButton style="margin:10px" Text="Cancelar" Click="() => ds.Close(false)" ButtonStyle="ButtonStyle.Light" class="me-1" />
                    <RadzenButton style="margin:10px" Text="Guardar" Click="GuardarTrastorno" class="me-1" />
                </div>


            </div>
        </div>
    </div>);


    }
}
