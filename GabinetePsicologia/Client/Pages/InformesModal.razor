@inject DialogService DialogService
@using GabinetePsicologia.Shared
@using GabinetePsicologia.Client.Shared
<PageTitle>Mis Datos</PageTitle>
@*@if (isInRole && userDto != null)*@
@if (true)
{
    <style>
        body .valid.modified:not([type=checkbox]) {
            outline: none;
        }

        body .invalid {
            outline: none;
        }
    </style>
    <div class="d-flex flex-column align-items-center justify-content-center ">
        <RadzenTemplateForm Data="@Informe" TItem="InformeDto" method="post" Submit="Guardar">
            @* Submit="@((PersonaDto args) => { GuardarPersona(args); })"*@
            <div>
                <div class="InformeModalDiv">

                    <div class="m-2">
                        @if (user.IsInRole("Paciente"))
                        {
                            <div class="field-container">

                                <RadzenText TextStyle="TextStyle.DisplayH6">Psicólogo: &nbsp; &nbsp; @Informe.PsicologoFullName</RadzenText>

                            </div>
                        }
                        <div class="field-container">
                            @if (!isNew)
                            {
                                @if (isPsicologo)
                                {
                                    <RadzenText TextStyle="TextStyle.DisplayH6">Paciente: &nbsp; &nbsp; @Informe.PacienteFullName &nbsp; </RadzenText>
                                }
                                @if (!String.IsNullOrEmpty(edad) && isPsicologo)
                                {
                                    <RadzenText TextStyle="TextStyle.DisplayH6">(@edad)</RadzenText>
                                }

                            }
                            else
                            {
                                <RadzenDropDown TValue="GabinetePsicologia.Shared.Paciente" Data=@lsPacientes FilterCaseSensitivity="FilterCaseSensitivity.CaseInsensitive" FilterOperator="StringFilterOperator.Contains" AllowFiltering="true"
                                        TextProperty="FullName" ValueProperty="Id" ReadOnly=!isPsicologo AllowClear=true Placeholder="Selecciona un Paciente" Change="@(args => changePaciente(args))" />
                            }

                        </div>
                    </div>
                    <hr />
                    <div class="m-2">
                        <div class="field-container">
                            @if (!user.IsInRole("Paciente"))
                            {
                                if (isNew)
                                {
                                    <RadzenDropDown TValue="GabinetePsicologia.Shared.Trastorno" Data=@lsTrastornos FilterCaseSensitivity="FilterCaseSensitivity.CaseInsensitive" FilterOperator="StringFilterOperator.Contains" AllowFiltering="true"
                                        TextProperty="NombreTipo" ValueProperty="Id" AllowClear=true Placeholder="Selecciona un Trastorno" Change="@(args => changeTrastorno(args))" />
                                }
                                else
                                {
                                    <RadzenText Style="margin: 0px;" TextStyle="TextStyle.Body1">Trastorno: &nbsp; &nbsp; @Informe.TrastornoName &nbsp; (@Informe.TrastornoTipo)</RadzenText>

                                }
                                <p style="margin: 0;">&nbsp; &nbsp; Severidad:&nbsp; &nbsp;</p>
                                <RadzenNumeric Min="1" Max="5" Visible=isPsicologo @bind-Value=@Informe.Severidad Style="border: 1px solid var(--rz-primary) !important;border-radius: var(--rz-border-radius-4) !important;" />
                            }
                        </div>
                    </div>
                    <div class="m-2 InformeModalTextArea">
                        @if (!user.IsInRole("Paciente"))
                        {
                            <RadzenLabel Text="Antecendentes Personales:" />
                            <RadzenTextArea @bind-Value=Informe.AntecendentesPersonales class="TextArea" />
                        }
                    </div>

                    <div class="m-2 InformeModalTextArea">
                        @if (!user.IsInRole("Paciente"))
                        {
                            <RadzenLabel Text="Evaluación Psicológica:" />
                            <RadzenTextArea @bind-Value=Informe.EvaluacionPsicologica class="TextArea" />
                        }
                    </div>
                    <div class="m-2 InformeModalTextArea">
                        @if (!isPsicologo)
                        {
                            <RadzenLabel Text="Plan de Tratamiento:" />
                        }
                        else
                        {
                            <RadzenLabel Text="Plan de Tratamiento: (Este campo es visible para el usuario.)" />
                        }

                        <RadzenTextArea @bind-Value=Informe.PlandDeTratamiento class="TextArea" />
                    </div>
                    <div class="m-2 InformeModalTextArea">
                        @if (!isPsicologo)
                        {
                            <RadzenLabel Text="Resultados:" />
                        }
                        else
                        {
                            <RadzenLabel Text="Resultados: (Este campo es visible para el usuario.)" />
                        }

                        <RadzenTextArea @bind-Value=Informe.Resultados class="TextArea" />
                    </div>
                </div>
                @if (!isNew)
                {
                    <div>
                        <div class="d-flex justify-content-center align-items-center" style="margin-top:10px;">
                            <RadzenButton Icon="description" Text="Archivos" class=@cssButtonArchivo Style="margin-right:3px" Click=clickArchivo />
                            <RadzenButton Icon="link" Text="Enlaces" class=@cssButtonEnlace Click=clickEnlace Style="margin-left:3px" />
                        </div>
                        @if (verArchivos)
                        {
                            <div class="d-flex justify-content-center align-items-center">
                                <RadzenUpload ChooseText="Subir Archivos" Style="background-color:none" Complete=complete Error=error Auto="true" Multiple="true" Icon="upload" Url="/Informe/UploadFile" class="d-flex justify-content-center align-items-lg-start">
                                    <RadzenUploadHeader Name="InformeId" Value=@Informe.Id.ToString() />
                                </RadzenUpload>
                                @if (isPsicologo)
                                {
                                    <RadzenUpload ChooseText="Subir Archivos Privados" Style="background-color:none" Complete=completePrivate Error=error Auto="true" Multiple="true" Icon="upload" Url="/Informe/UploadFilePrivate" class="d-flex justify-content-center align-items-lg-start">
                                        <RadzenUploadHeader Name="InformeId" Value=@Informe.Id.ToString() />
                                    </RadzenUpload>
                                }

                            </div>
                        }
                    </div>

                    <div class="d-flex justify-content-center align-items-center">
                        @if (verArchivos && lsFiles.Count > 0)
                        {

                            <table class="content-table">
                                <thead>
                                    <tr>
                                        <th>Archivo</th>
                                        @if (isPsicologo)
                                        {
                                            <th>Visible para el usuario</th>
                                        }
                                        <th>Descargar</th>
                                        @if (isPsicologo)
                                        {
                                            <th>Eliminar</th>
                                        }
                                    </tr>
                                </thead>
                                <tbody>

                                    @foreach (var x in lsFiles)
                                    {
                                        <tr>
                                            <td>@x[0]</td>
                                            @if (isPsicologo)
                                            {
                                                <td>@x[1]</td>
                                            }
                                            <td>   <RadzenButton Icon="download" Click="() => Descargar(x)" class="BotonLapiz" /></td>
                                            @if (isPsicologo)
                                            {
                                                <td>   <RadzenButton Icon="delete" Click="() => Borrar(x)" class="BotonLapiz" /></td>
                                            }


                                        </tr>
                                    }
                                </tbody>
                            </table>
                        }
                    </div>
                }
                else
                {
                    <div class="d-flex justify-content-center align-items-center">
                        <p>para añadir archivos tienes que guardar antes el Informe</p>
                    </div>
                }
                <br />

                <br />
                @if (isPsicologo)
                {
                    <div class="d-flex justify-content-evenly">
                        <RadzenButton Icon="save" Text="Guardar Informe" ButtonType="ButtonType.Submit" />
                    </div>
                }
                @if (!isNew)
                {
                    <br />

                    <br />
                    <div class="m-2">
                        <div class="field-container" style="justify-content:center; align-content:center">
                            <RadzenLabel Text="Última Fecha de Modificación:" />
                            <p class="@cssClass" style="padding: var(--rz-input-padding);margin-bottom:0 !important"> @Informe.UltimaFechaString </p>
                        </div>


                    </div>
                }
            </div>
        </RadzenTemplateForm>
    </div>
}
else
{
    @*if (isInRole)
    {
        <Loading />
    }
    else
    {
        <_403 />
    }*@

}
